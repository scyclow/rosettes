{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/optimize-paths/dist/index.js","webpack:///./src/plan.worker.js","webpack:///./node_modules/optimize-paths/dist/vec.js","webpack:///./node_modules/optimize-paths/dist/knn.js","webpack:///./node_modules/tinyqueue/index.js","webpack:///./node_modules/rbush/rbush.min.js","webpack:///./src/vec.ts","webpack:///./src/paper-size.ts","webpack:///./src/planning.ts","webpack:///./src/util.ts","webpack:///./src/massager.ts","webpack:///./src/background-planner.ts"],"names":["enumerable","get","getter","value","key","bind","module","Object","prototype","hasOwnProperty","call","object","property","__importDefault","this","mod","__esModule","defineProperty","exports","reorder","elideShorterThan","merge","vec_1","knn_1","rbush_1","dropWhile","a","f","slice","findIndex","x","range","lo","hi","i","pointLists","tolerance","length","tol2","pl","result","shift","l","n","lp","np","dx","dy","y","concat","v","push","minimumPathLength","filter","pointList","lastPoint","vlen","vsub","pathLength","pt","PointRBush","default","minX","minY","maxX","maxY","b","tree","load","sortedPointLists","cur","nn","knn","plId","remove","reverse","vlen2","Math","sqrt","tinyqueue_1","compareDist","dist","boxDist","box","axisDist","k","min","max","predicate","maxDistance","child","candidate","node","data","toBBox","queue","undefined","children","leaf","isItem","peek","pop","TinyQueue","compare","defaultCompare","_down","item","_up","top","bottom","pos","parent","current","halfLength","left","best","right","t","r","e","h","o","s","log","exp","u","floor","p","d","_maxEntries","_minEntries","ceil","clear","indexOf","m","c","height","all","_all","search","collides","insert","_build","_splitRoot","_insert","splice","_condense","compareMinX","compareMinY","toJSON","fromJSON","apply","pow","_chooseSubtree","_split","_adjustParentBBoxes","_chooseSplitAxis","_chooseSplitIndex","M","_allDistMargin","sort","vmul","vnorm","vadd","vround","digits","Number","toFixed","PaperSize","size","standard","Device","ArchA","landscape","Set","Axidraw","stepsPerMm","penServoMin","penServoMax","pct","round","penPctToPos","accel","duration","vInitial","p1","p2","Error","distance","tU","dt","ds","PenMotion","initialPos","finalPos","pDuration","scanLeft","z","op","acc","XYMotion","blocks","ts","map","ss","deserialize","reduce","idx","array","obj","low","high","mid","sortedIndex","blockIdx","instant","serialize","Plan","motions","start","penUpHeight","penDownHeight","penMotionIndex","motion","j","maxEntryVelocity","entryVelocity","computeTriangle","initialVel","finalVel","p3","acceleratingDistance","deceleratingDistance","vMax","s1","s2","t1","t2","computeTrapezoid","maxVel","p4","t3","s3","dir","constantAccelerationPlan","points","profile","dedupedPoints","epsilon","dedupPoints","segments","acceleration","maximumVelocity","cornerFactor","corneringFactor","forEach","seg2","seg1","cosine","direction","abs","sine","cornerVelocity","segment","nextSegment","vExit","vFinal","scaleToPaper","paperSize","marginMm","targetMin","targetMax","Infinity","extent","availWidthMm","availHeightMm","scaleFitX","scaleFitY","scale","targetCenter","offset","scaleToFit","liangBarsky","aabb","seg","lower","upper","delta","q","u1","u2","contains","point","truncate","containsA","containsB","forwards","backwards","cropLineToAabb","truncatedPointLists","currentPointList","truncated","mmPerSvgUnit","replan","inPaths","planOptions","paths","rotateDrawing","console","time","radians","PI","cos","sin","vrot","timeEnd","fitPage","ps","cropToMargins","pageAabb","margin","insetAabb","croppedLine","layerMode","path","selectedGroupLayers","has","groupId","selectedStrokeLayers","stroke","pointJoinRadius","epsilon2","sortPaths","pathJoinRadius","plan","curPos","penMaxUpPos","penUpPos","penDownPos","penDownProfile","penUpProfile","penDropDuration","penLiftDuration","penDownAcceleration","penDownMaxVelocity","penDownCorneringFactor","penUpAcceleration","penUpMaxVelocity","self","addEventListener","serialized","postMessage"],"mappings":"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","file":"62968d0da6ce3454d9c0.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reorder = exports.elideShorterThan = exports.merge = void 0;\nconst vec_1 = require(\"./vec\");\nconst knn_1 = require(\"./knn\");\nconst rbush_1 = __importDefault(require(\"rbush\"));\nfunction dropWhile(a, f) {\n    return a.slice(a.findIndex((x) => !f(x)));\n}\n/**\n * Joins adjacent pairs of pointLists where the first ends within tolerance of where the second begins.\n *\n * e.g. with tolerance >= 0.1,\n * `[[{x: 0, y: 0}, {x: 10, y: 0}], [{x: 10.1, y: 0}, {x: 20, y: 0}]]` becomes\n * `[[{x: 0, y: 0}, {x: 10, y: 0}, {x: 20, y: 0}]]`.\n *\n * @param pointLists List of paths to join\n * @param tolerance When the endpoints of adjacent paths are closer than this, they will be joined into one path.\n * @return The optimized path list.\n */\nfunction merge(pointLists, tolerance = 0.5) {\n    if (pointLists.length === 0)\n        return [];\n    const tol2 = tolerance * tolerance;\n    const pl = pointLists.slice();\n    const result = [pl.shift()];\n    while (pl.length) {\n        const l = result[result.length - 1];\n        const n = pl.shift();\n        const lp = l[l.length - 1];\n        const np = n[0];\n        // inline d = vlen2(vsub(lp, np))\n        const dx = lp.x - np.x;\n        const dy = lp.y - np.y;\n        const d = dx * dx + dy * dy;\n        if (d <= tol2) {\n            result[result.length - 1] = result[result.length - 1].concat(dropWhile(n, (v) => {\n                // inline d = vlen2(vsub(lp, v))\n                const dx = lp.x - v.x;\n                const dy = lp.y - v.y;\n                const d = dx * dx + dy * dy;\n                return d <= tol2;\n            }));\n        }\n        else {\n            result.push(n);\n        }\n    }\n    return result;\n}\nexports.merge = merge;\nfunction pathLength(pointList) {\n    if (pointList.length <= 1) {\n        return 0;\n    }\n    let length = 0;\n    let lastPoint = pointList[0];\n    for (let i = 1; i < pointList.length; i++) {\n        length += vec_1.vlen(vec_1.vsub(lastPoint, pointList[i]));\n        lastPoint = pointList[i];\n    }\n    return length;\n}\n/**\n * Filters out paths shorter than a certain length.\n *\n * @param pointLists List of paths to filter\n * @param minimumPathLength Paths whose length is less than this value will be filtered out.\n * @returns A new point list, with short paths excluded.\n */\nfunction elideShorterThan(pointLists, minimumPathLength) {\n    return pointLists.filter((pl) => pathLength(pl) >= minimumPathLength);\n}\nexports.elideShorterThan = elideShorterThan;\nfunction* range(lo, hi) {\n    for (let i = lo; i < hi; i++)\n        yield i;\n}\n/** Reorder paths greedily, attempting to minimize the amount of pen-up travel time. */\nfunction reorder(pointLists) {\n    if (pointLists.length === 0) {\n        return pointLists;\n    }\n    const pt = (i) => i % 2 === 0\n        ? pointLists[(i / 2) | 0][0]\n        : pointLists[(i / 2) | 0][pointLists[(i / 2) | 0].length - 1];\n    class PointRBush extends rbush_1.default {\n        toBBox(i) { const { x, y } = pt(i); return { minX: x, minY: y, maxX: x, maxY: y }; }\n        compareMinX(a, b) { return pt(a).x - pt(b).x; }\n        compareMinY(a, b) { return pt(a).y - pt(b).y; }\n    }\n    const tree = new PointRBush;\n    tree.load([...range(2, pointLists.length * 2)]);\n    const sortedPointLists = [];\n    sortedPointLists.push(pointLists[0]);\n    let cur = pt(1);\n    let n = pointLists.length * 2 - 2;\n    while (n) {\n        const [nn] = knn_1.knn(tree, cur.x, cur.y, 1);\n        const plId = (nn / 2) | 0;\n        tree.remove(plId * 2);\n        tree.remove(plId * 2 + 1);\n        sortedPointLists.push(nn % 2 === 0\n            ? pointLists[plId]\n            : pointLists[plId].slice().reverse());\n        // if nn points to the beginning of a path, next search is from end of the path\n        // if nn points to the end of a path, next search is from beginning of the path\n        cur = pt(nn % 2 === 0 ? nn + 1 : nn - 1);\n        n -= 2;\n    }\n    return sortedPointLists;\n}\nexports.reorder = reorder;\n//# sourceMappingURL=index.js.map","require(\"./background-planner\");\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.vsub = exports.vlen = exports.vlen2 = void 0;\nfunction vlen2(a) {\n    return a.x * a.x + a.y * a.y;\n}\nexports.vlen2 = vlen2;\nfunction vlen(a) {\n    return Math.sqrt(vlen2(a));\n}\nexports.vlen = vlen;\nfunction vsub(a, b) {\n    return { x: a.x - b.x, y: a.y - b.y };\n}\nexports.vsub = vsub;\n//# sourceMappingURL=vec.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.knn = void 0;\nconst tinyqueue_1 = __importDefault(require(\"tinyqueue\"));\nfunction knn(tree, x, y, n, predicate, maxDistance) {\n    let node = tree.data, result = [], toBBox = tree.toBBox, i, child, dist, candidate;\n    let queue = new tinyqueue_1.default(undefined, compareDist);\n    while (node) {\n        for (i = 0; i < node.children.length; i++) {\n            child = node.children[i];\n            dist = boxDist(x, y, node.leaf ? toBBox(child) : child);\n            if (!maxDistance || dist <= maxDistance * maxDistance) {\n                queue.push({\n                    node: child,\n                    isItem: node.leaf,\n                    dist: dist\n                });\n            }\n        }\n        while (queue.length && queue.peek().isItem) {\n            candidate = queue.pop().node;\n            if (!predicate || predicate(candidate))\n                result.push(candidate);\n            if (n && result.length === n)\n                return result;\n        }\n        node = queue.pop();\n        if (node)\n            node = node.node;\n    }\n    return result;\n}\nexports.knn = knn;\nfunction compareDist(a, b) {\n    return a.dist - b.dist;\n}\nfunction boxDist(x, y, box) {\n    var dx = axisDist(x, box.minX, box.maxX), dy = axisDist(y, box.minY, box.maxY);\n    return dx * dx + dy * dy;\n}\nfunction axisDist(k, min, max) {\n    return k < min ? min - k : k <= max ? 0 : k - max;\n}\n//# sourceMappingURL=knn.js.map","\nexport default class TinyQueue {\n    constructor(data = [], compare = defaultCompare) {\n        this.data = data;\n        this.length = this.data.length;\n        this.compare = compare;\n\n        if (this.length > 0) {\n            for (let i = (this.length >> 1) - 1; i >= 0; i--) this._down(i);\n        }\n    }\n\n    push(item) {\n        this.data.push(item);\n        this.length++;\n        this._up(this.length - 1);\n    }\n\n    pop() {\n        if (this.length === 0) return undefined;\n\n        const top = this.data[0];\n        const bottom = this.data.pop();\n        this.length--;\n\n        if (this.length > 0) {\n            this.data[0] = bottom;\n            this._down(0);\n        }\n\n        return top;\n    }\n\n    peek() {\n        return this.data[0];\n    }\n\n    _up(pos) {\n        const {data, compare} = this;\n        const item = data[pos];\n\n        while (pos > 0) {\n            const parent = (pos - 1) >> 1;\n            const current = data[parent];\n            if (compare(item, current) >= 0) break;\n            data[pos] = current;\n            pos = parent;\n        }\n\n        data[pos] = item;\n    }\n\n    _down(pos) {\n        const {data, compare} = this;\n        const halfLength = this.length >> 1;\n        const item = data[pos];\n\n        while (pos < halfLength) {\n            let left = (pos << 1) + 1;\n            let best = data[left];\n            const right = left + 1;\n\n            if (right < this.length && compare(data[right], best) < 0) {\n                left = right;\n                best = data[right];\n            }\n            if (compare(best, item) >= 0) break;\n\n            data[pos] = best;\n            pos = left;\n        }\n\n        data[pos] = item;\n    }\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n","!function(t,i){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=i():\"function\"==typeof define&&define.amd?define(i):(t=t||self).RBush=i()}(this,function(){\"use strict\";function t(t,r,e,a,h){!function t(n,r,e,a,h){for(;a>e;){if(a-e>600){var o=a-e+1,s=r-e+1,l=Math.log(o),f=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*f*(o-f)/o)*(s-o/2<0?-1:1),m=Math.max(e,Math.floor(r-s*f/o+u)),c=Math.min(a,Math.floor(r+(o-s)*f/o+u));t(n,r,m,c,h)}var p=n[r],d=e,x=a;for(i(n,e,r),h(n[a],p)>0&&i(n,e,a);d<x;){for(i(n,d,x),d++,x--;h(n[d],p)<0;)d++;for(;h(n[x],p)>0;)x--}0===h(n[e],p)?i(n,e,x):i(n,++x,a),x<=r&&(e=x+1),r<=x&&(a=x-1)}}(t,r,e||0,a||t.length-1,h||n)}function i(t,i,n){var r=t[i];t[i]=t[n],t[n]=r}function n(t,i){return t<i?-1:t>i?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function e(t,i,n){if(!n)return i.indexOf(t);for(var r=0;r<i.length;r++)if(n(t,i[r]))return r;return-1}function a(t,i){h(t,0,t.children.length,i,t)}function h(t,i,n,r,e){e||(e=p(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(var a=i;a<n;a++){var h=t.children[a];o(e,t.leaf?r(h):h)}return e}function o(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function s(t,i){return t.minX-i.minX}function l(t,i){return t.minY-i.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function c(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(i,n,r,e,a){for(var h=[n,r];h.length;)if(!((r=h.pop())-(n=h.pop())<=e)){var o=n+Math.ceil((r-n)/e/2)*e;t(i,o,n,r,a),h.push(n,o,o,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var i=this.data,n=[];if(!c(t,i))return n;for(var r=this.toBBox,e=[];i;){for(var a=0;a<i.children.length;a++){var h=i.children[a],o=i.leaf?r(h):h;c(t,o)&&(i.leaf?n.push(h):m(t,o)?this._all(h,n):e.push(h))}i=e.pop()}return n},r.prototype.collides=function(t){var i=this.data;if(!c(t,i))return!1;for(var n=[];i;){for(var r=0;r<i.children.length;r++){var e=i.children[r],a=i.leaf?this.toBBox(e):e;if(c(t,a)){if(i.leaf||m(t,a))return!0;n.push(e)}}i=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0;i<t.length;i++)this.insert(t[i]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(t,i){if(!t)return this;for(var n,r,a,h=this.data,o=this.toBBox(t),s=[],l=[];h||s.length;){if(h||(h=s.pop(),r=s[s.length-1],n=l.pop(),a=!0),h.leaf){var f=e(t,h.children,i);if(-1!==f)return h.children.splice(f,1),s.push(h),this._condense(s),this}a||h.leaf||!m(h,o)?r?(n++,h=r.children[n],a=!1):h=null:(s.push(h),l.push(n),n=0,r=h,h=h.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,i){return t.minX-i.minX},r.prototype.compareMinY=function(t,i){return t.minY-i.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},r.prototype._build=function(t,i,n,r){var e,h=n-i+1,o=this._maxEntries;if(h<=o)return a(e=p(t.slice(i,n+1)),this.toBBox),e;r||(r=Math.ceil(Math.log(h)/Math.log(o)),o=Math.ceil(h/Math.pow(o,r-1))),(e=p([])).leaf=!1,e.height=r;var s=Math.ceil(h/o),l=s*Math.ceil(Math.sqrt(o));d(t,i,n,l,this.compareMinX);for(var f=i;f<=n;f+=l){var u=Math.min(f+l-1,n);d(t,f,u,s,this.compareMinY);for(var m=f;m<=u;m+=s){var c=Math.min(m+s-1,u);e.children.push(this._build(t,m,c,r-1))}}return a(e,this.toBBox),e},r.prototype._chooseSubtree=function(t,i,n,r){for(;r.push(i),!i.leaf&&r.length-1!==n;){for(var e=1/0,a=1/0,h=void 0,o=0;o<i.children.length;o++){var s=i.children[o],l=f(s),u=(m=t,c=s,(Math.max(c.maxX,m.maxX)-Math.min(c.minX,m.minX))*(Math.max(c.maxY,m.maxY)-Math.min(c.minY,m.minY))-l);u<a?(a=u,e=l<e?l:e,h=s):u===a&&l<e&&(e=l,h=s)}i=h||i.children[0]}var m,c;return i},r.prototype._insert=function(t,i,n){var r=n?t:this.toBBox(t),e=[],a=this._chooseSubtree(r,this.data,i,e);for(a.children.push(t),o(a,r);i>=0&&e[i].children.length>this._maxEntries;)this._split(e,i),i--;this._adjustParentBBoxes(r,e,i)},r.prototype._split=function(t,i){var n=t[i],r=n.children.length,e=this._minEntries;this._chooseSplitAxis(n,e,r);var h=this._chooseSplitIndex(n,e,r),o=p(n.children.splice(h,n.children.length-h));o.height=n.height,o.leaf=n.leaf,a(n,this.toBBox),a(o,this.toBBox),i?t[i-1].children.push(o):this._splitRoot(n,o)},r.prototype._splitRoot=function(t,i){this.data=p([t,i]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,i,n){for(var r,e,a,o,s,l,u,m=1/0,c=1/0,p=i;p<=n-i;p++){var d=h(t,0,p,this.toBBox),x=h(t,p,n,this.toBBox),v=(e=d,a=x,o=void 0,s=void 0,l=void 0,u=void 0,o=Math.max(e.minX,a.minX),s=Math.max(e.minY,a.minY),l=Math.min(e.maxX,a.maxX),u=Math.min(e.maxY,a.maxY),Math.max(0,l-o)*Math.max(0,u-s)),M=f(d)+f(x);v<m?(m=v,r=p,c=M<c?M:c):v===m&&M<c&&(c=M,r=p)}return r||n-i},r.prototype._chooseSplitAxis=function(t,i,n){var r=t.leaf?this.compareMinX:s,e=t.leaf?this.compareMinY:l;this._allDistMargin(t,i,n,r)<this._allDistMargin(t,i,n,e)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,i,n,r){t.children.sort(r);for(var e=this.toBBox,a=h(t,0,i,e),s=h(t,n-i,n,e),l=u(a)+u(s),f=i;f<n-i;f++){var m=t.children[f];o(a,t.leaf?e(m):m),l+=u(a)}for(var c=n-i-1;c>=i;c--){var p=t.children[c];o(s,t.leaf?e(p):p),l+=u(s)}return l},r.prototype._adjustParentBBoxes=function(t,i,n){for(var r=n;r>=0;r--)o(i[r],t)},r.prototype._condense=function(t){for(var i=t.length-1,n=void 0;i>=0;i--)0===t[i].children.length?i>0?(n=t[i-1].children).splice(n.indexOf(t[i]),1):this.clear():a(t[i],this.toBBox)},r});\n","export function vlen2(a) {\n    return a.x * a.x + a.y * a.y;\n}\nexport function vlen(a) {\n    return Math.sqrt(vlen2(a));\n}\nexport function vsub(a, b) {\n    return { x: a.x - b.x, y: a.y - b.y };\n}\nexport function vmul(a, s) {\n    return { x: a.x * s, y: a.y * s };\n}\nexport function vnorm(a) {\n    return vmul(a, 1 / vlen(a));\n}\nexport function vadd(a, b) {\n    return { x: a.x + b.x, y: a.y + b.y };\n}\nexport function vdot(a, b) {\n    return a.x * b.x + a.y * b.y;\n}\nexport function vrot(v, c, a) {\n    if (a === 0)\n        return v;\n    let radians = (Math.PI / 180) * a, cos = Math.cos(radians), sin = Math.sin(radians), nx = cos * (v.x - c.x) - sin * (v.y - c.y) + c.x, ny = cos * (v.y - c.y) + sin * (v.x - c.x) + c.y;\n    return { x: nx, y: ny };\n}\n","import { vmul } from \"./vec\";\nfunction vround(v, digits = 2) {\n    return { x: Number(v.x.toFixed(digits)), y: Number(v.y.toFixed(digits)) };\n}\nexport class PaperSize {\n    constructor(size) {\n        this.size = size;\n    }\n    get landscape() {\n        return new PaperSize({\n            x: Math.max(this.size.x, this.size.y),\n            y: Math.min(this.size.x, this.size.y),\n        });\n    }\n    get portrait() {\n        return new PaperSize({\n            x: Math.min(this.size.x, this.size.y),\n            y: Math.max(this.size.x, this.size.y),\n        });\n    }\n    get isLandscape() {\n        return this.size.x === Math.max(this.size.x, this.size.y);\n    }\n}\nPaperSize.standard = {\n    \"USLetter\": new PaperSize(vround(vmul({ x: 8.5, y: 11 }, 25.4))),\n    \"USLegal\": new PaperSize(vround(vmul({ x: 8.5, y: 14 }, 25.4))),\n    \"ArchA\": new PaperSize(vround(vmul({ x: 9, y: 12 }, 25.4))),\n    \"A3\": new PaperSize({ x: 297, y: 420 }),\n    \"A4\": new PaperSize({ x: 210, y: 297 }),\n    \"A5\": new PaperSize({ x: 148, y: 210 }),\n    \"A6\": new PaperSize({ x: 105, y: 148 }),\n    \"6x8\": new PaperSize(vround(vmul({ x: 6, y: 8 }, 25.4))),\n    \"5x7\": new PaperSize(vround(vmul({ x: 5, y: 7 }, 25.4))),\n    \"11x14\": new PaperSize(vround(vmul({ x: 11, y: 14 }, 25.4))),\n};\n","/**\n * Cribbed from https://github.com/fogleman/axi/blob/master/axi/planner.py\n */\nconst epsilon = 1e-9;\nimport { PaperSize } from \"./paper-size\";\nimport { vadd, vdot, vlen, vmul, vnorm, vsub } from \"./vec\";\nexport const defaultPlanOptions = {\n    penUpHeight: 50,\n    penDownHeight: 60,\n    pointJoinRadius: 0,\n    pathJoinRadius: 0.5,\n    paperSize: PaperSize.standard.ArchA.landscape,\n    marginMm: 20,\n    selectedGroupLayers: new Set(),\n    selectedStrokeLayers: new Set(),\n    layerMode: 'stroke',\n    penDownAcceleration: 200,\n    penDownMaxVelocity: 50,\n    penDownCorneringFactor: 0.127,\n    penUpAcceleration: 400,\n    penUpMaxVelocity: 200,\n    penDropDuration: 0.12,\n    penLiftDuration: 0.12,\n    sortPaths: true,\n    rotateDrawing: 0,\n    fitPage: true,\n    cropToMargins: true,\n    minimumPathLength: 0,\n};\nexport const Device = {\n    Axidraw: {\n        stepsPerMm: 5,\n        // Practical min/max that you might ever want the pen servo to go on the AxiDraw (v2)\n        // Units: 83ns resolution pwm output.\n        // Defaults: penup at 12000 (1ms), pendown at 16000 (1.33ms).\n        penServoMin: 7500,\n        penServoMax: 28000,\n        penPctToPos(pct) {\n            const t = pct / 100.0;\n            return Math.round(this.penServoMin * t + this.penServoMax * (1 - t));\n        }\n    }\n};\nexport const AxidrawFast = {\n    penDownProfile: {\n        acceleration: 200 * Device.Axidraw.stepsPerMm,\n        maximumVelocity: 50 * Device.Axidraw.stepsPerMm,\n        corneringFactor: 0.127 * Device.Axidraw.stepsPerMm\n    },\n    penUpProfile: {\n        acceleration: 400 * Device.Axidraw.stepsPerMm,\n        maximumVelocity: 200 * Device.Axidraw.stepsPerMm,\n        corneringFactor: 0\n    },\n    penUpPos: Device.Axidraw.penPctToPos(50),\n    penDownPos: Device.Axidraw.penPctToPos(60),\n    penDropDuration: 0.12,\n    penLiftDuration: 0.12,\n};\nexport class Block {\n    constructor(accel, duration, vInitial, p1, p2) {\n        if (!(vInitial >= 0)) {\n            throw new Error(`vInitial must be >= 0, but was ${vInitial}`);\n        }\n        if (!(vInitial + accel * duration >= -epsilon)) {\n            throw new Error(`vFinal must be >= 0, but vInitial=${vInitial}, duration=${duration}, accel=${accel}`);\n        }\n        this.accel = accel;\n        this.duration = duration;\n        this.vInitial = vInitial;\n        this.p1 = p1;\n        this.p2 = p2;\n        this.distance = vlen(vsub(p1, p2));\n    }\n    static deserialize(o) {\n        return new Block(o.accel, o.duration, o.vInitial, o.p1, o.p2);\n    }\n    get vFinal() { return Math.max(0, this.vInitial + this.accel * this.duration); }\n    instant(tU, dt = 0, ds = 0) {\n        const t = Math.max(0, Math.min(this.duration, tU));\n        const a = this.accel;\n        const v = this.vInitial + this.accel * t;\n        const s = Math.max(0, Math.min(this.distance, this.vInitial * t + a * t * t / 2));\n        const p = vadd(this.p1, vmul(vnorm(vsub(this.p2, this.p1)), s));\n        return { t: t + dt, p, s: s + ds, v, a };\n    }\n    serialize() {\n        return {\n            accel: this.accel,\n            duration: this.duration,\n            vInitial: this.vInitial,\n            p1: this.p1,\n            p2: this.p2,\n        };\n    }\n}\nexport class PenMotion {\n    constructor(initialPos, finalPos, duration) {\n        this.initialPos = initialPos;\n        this.finalPos = finalPos;\n        this.pDuration = duration;\n    }\n    static deserialize(o) {\n        return new PenMotion(o.initialPos, o.finalPos, o.duration);\n    }\n    duration() {\n        return this.pDuration;\n    }\n    serialize() {\n        return {\n            t: \"PenMotion\",\n            initialPos: this.initialPos,\n            finalPos: this.finalPos,\n            duration: this.pDuration,\n        };\n    }\n}\nfunction scanLeft(a, z, op) {\n    const b = [];\n    let acc = z;\n    b.push(acc);\n    for (const x of a) {\n        acc = op(acc, x);\n        b.push(acc);\n    }\n    return b;\n}\nfunction sortedIndex(array, obj) {\n    let low = 0;\n    let high = array.length;\n    while (low < high) {\n        const mid = Math.floor((low + high) / 2);\n        if (array[mid] < obj) {\n            low = mid + 1;\n        }\n        else {\n            high = mid;\n        }\n    }\n    return low;\n}\nexport class XYMotion {\n    constructor(blocks) {\n        this.blocks = blocks;\n        this.ts = scanLeft(blocks.map((b) => b.duration), 0, (a, b) => a + b).slice(0, -1);\n        this.ss = scanLeft(blocks.map((b) => b.distance), 0, (a, b) => a + b).slice(0, -1);\n    }\n    static deserialize(o) {\n        return new XYMotion(o.blocks.map(Block.deserialize));\n    }\n    get p1() {\n        return this.blocks[0].p1;\n    }\n    get p2() {\n        return this.blocks[this.blocks.length - 1].p2;\n    }\n    duration() {\n        return this.blocks.map((b) => b.duration).reduce((a, b) => a + b, 0);\n    }\n    instant(t) {\n        const idx = sortedIndex(this.ts, t);\n        const blockIdx = this.ts[idx] === t ? idx : idx - 1;\n        const block = this.blocks[blockIdx];\n        return block.instant(t - this.ts[blockIdx], this.ts[blockIdx], this.ss[blockIdx]);\n    }\n    serialize() {\n        return {\n            t: \"XYMotion\",\n            blocks: this.blocks.map((b) => b.serialize())\n        };\n    }\n}\nexport class Plan {\n    constructor(motions) {\n        this.motions = motions;\n    }\n    static deserialize(o) {\n        return new Plan(o.motions.map((m) => {\n            switch (m.t) {\n                case \"XYMotion\": return XYMotion.deserialize(m);\n                case \"PenMotion\": return PenMotion.deserialize(m);\n            }\n        }));\n    }\n    duration(start = 0) {\n        return this.motions.slice(start).map((m) => m.duration()).reduce((a, b) => a + b, 0);\n    }\n    motion(i) { return this.motions[i]; }\n    withPenHeights(penUpHeight, penDownHeight) {\n        let penMotionIndex = 0;\n        return new Plan(this.motions.map((motion, j) => {\n            if (motion instanceof XYMotion) {\n                return motion;\n            }\n            else if (motion instanceof PenMotion) {\n                // Uuuugh this is really hacky. We should instead store the\n                // pen-up/pen-down heights in a single place and reference them from\n                // the PenMotions. Then we can change them in just one place.\n                if (j === this.motions.length - 3) {\n                    return new PenMotion(penDownHeight, Device.Axidraw.penPctToPos(0), motion.duration());\n                }\n                else if (j === this.motions.length - 1) {\n                    return new PenMotion(Device.Axidraw.penPctToPos(0), penUpHeight, motion.duration());\n                }\n                return (penMotionIndex++ % 2 === 0\n                    ? new PenMotion(penUpHeight, penDownHeight, motion.duration())\n                    : new PenMotion(penDownHeight, penUpHeight, motion.duration()));\n            }\n        }));\n    }\n    serialize() {\n        return {\n            motions: this.motions.map((m) => m.serialize())\n        };\n    }\n}\nclass Segment {\n    constructor(p1, p2) {\n        this.maxEntryVelocity = 0;\n        this.entryVelocity = 0;\n        this.p1 = p1;\n        this.p2 = p2;\n        this.blocks = [];\n    }\n    length() { return vlen(vsub(this.p2, this.p1)); }\n    direction() { return vnorm(vsub(this.p2, this.p1)); }\n}\nfunction cornerVelocity(seg1, seg2, vMax, accel, cornerFactor) {\n    // https://onehossshay.wordpress.com/2011/09/24/improving_grbl_cornering_algorithm/\n    const cosine = -vdot(seg1.direction(), seg2.direction());\n    // assert(!cosine.isNaN, s\"cosine was NaN: $seg1, $seg2, ${seg1.direction}, ${seg2.direction}\")\n    if (Math.abs(cosine - 1) < epsilon) {\n        return 0;\n    }\n    const sine = Math.sqrt((1 - cosine) / 2);\n    if (Math.abs(sine - 1) < epsilon) {\n        return vMax;\n    }\n    const v = Math.sqrt((accel * cornerFactor * sine) / (1 - sine));\n    // assert(!v.isNaN, s\"v was NaN: $accel, $cornerFactor, $sine\")\n    return Math.min(v, vMax);\n}\n/** Compute a triangular velocity profile with piecewise constant acceleration.\n *\n * The maximum velocity is derived from the acceleration and the distance to be travelled.\n *\n * @param distance Distance to travel (equal to |p3-p1|).\n * @param initialVel Starting velocity, unit length per unit time.\n * @param finalVel Final velocity, unit length per unit time.\n * @param accel Magnitude of acceleration, unit length per unit time per unit time.\n * @param p1 Starting point.\n * @param p3 Ending point.\n * @return\n */\nfunction computeTriangle(distance, initialVel, finalVel, accel, p1, p3) {\n    const acceleratingDistance = (2 * accel * distance + finalVel * finalVel - initialVel * initialVel) / (4 * accel);\n    const deceleratingDistance = distance - acceleratingDistance;\n    const vMax = Math.sqrt(initialVel * initialVel + 2 * accel * acceleratingDistance);\n    const t1 = (vMax - initialVel) / accel;\n    const t2 = (finalVel - vMax) / -accel;\n    const p2 = vadd(p1, vmul(vnorm(vsub(p3, p1)), acceleratingDistance));\n    return { s1: acceleratingDistance, s2: deceleratingDistance, t1, t2, vMax, p1, p2, p3 };\n}\nfunction computeTrapezoid(distance, initialVel, maxVel, finalVel, accel, p1, p4) {\n    const t1 = (maxVel - initialVel) / accel;\n    const s1 = (maxVel + initialVel) / 2 * t1;\n    const t3 = (finalVel - maxVel) / -accel;\n    const s3 = (finalVel + maxVel) / 2 * t3;\n    const s2 = distance - s1 - s3;\n    const t2 = s2 / maxVel;\n    const dir = vnorm(vsub(p4, p1));\n    const p2 = vadd(p1, vmul(dir, s1));\n    const p3 = vadd(p1, vmul(dir, (distance - s3)));\n    return { s1, s2, s3, t1, t2, t3, p1, p2, p3, p4 };\n}\nfunction dedupPoints(points, epsilon) {\n    if (epsilon === 0) {\n        return points;\n    }\n    const dedupedPoints = [];\n    dedupedPoints.push(points[0]);\n    for (const p of points.slice(1)) {\n        if (vlen(vsub(p, dedupedPoints[dedupedPoints.length - 1])) > epsilon) {\n            dedupedPoints.push(p);\n        }\n    }\n    return dedupedPoints;\n}\n/**\n * Plan a path, using a constant acceleration profile.\n * This function plans only a single x/y motion of the tool,\n * i.e. between a single pen-down/pen-up pair.\n *\n * @param points Sequence of points to pass through\n * @param profile Tooling profile to use\n * @return A plan of action\n */\nfunction constantAccelerationPlan(points, profile) {\n    const dedupedPoints = dedupPoints(points, epsilon);\n    if (dedupedPoints.length === 1) {\n        return new XYMotion([new Block(0, 0, 0, dedupedPoints[0], dedupedPoints[0])]);\n    }\n    const segments = dedupedPoints.slice(1).map((a, i) => new Segment(dedupedPoints[i], a));\n    const accel = profile.acceleration;\n    const vMax = profile.maximumVelocity;\n    const cornerFactor = profile.corneringFactor;\n    // Calculate the maximum entry velocity for each segment based on the angle between it\n    // and the previous segment.\n    segments.slice(1).forEach((seg2, i) => {\n        const seg1 = segments[i];\n        seg2.maxEntryVelocity = cornerVelocity(seg1, seg2, vMax, accel, cornerFactor);\n    });\n    // This is to force the velocity to zero at the end of the path.\n    const lastPoint = dedupedPoints[dedupedPoints.length - 1];\n    segments.push(new Segment(lastPoint, lastPoint));\n    let i = 0;\n    while (i < segments.length - 1) {\n        const segment = segments[i];\n        const nextSegment = segments[i + 1];\n        const distance = segment.length();\n        const vInitial = segment.entryVelocity;\n        const vExit = nextSegment.maxEntryVelocity;\n        const p1 = segment.p1;\n        const p2 = segment.p2;\n        const m = computeTriangle(distance, vInitial, vExit, accel, p1, p2);\n        if (m.s1 < -epsilon) {\n            // We'd have to start decelerating _before we started on this segment_. backtrack.\n            // In order enter this segment slow enough to be leaving it at vExit, we need to\n            // compute a maximum entry velocity s.t. we can slow down in the distance we have.\n            // TODO: verify this equation.\n            segment.maxEntryVelocity = Math.sqrt(vExit * vExit + 2 * accel * distance);\n            i -= 1;\n        }\n        else if (m.s2 <= 0) {\n            // No deceleration.\n            // TODO: shouldn't we check vMax here and maybe do trapezoid? should the next case below come first?\n            const vFinal = Math.sqrt(vInitial * vInitial + 2 * accel * distance);\n            const t = (vFinal - vInitial) / accel;\n            segment.blocks = [\n                new Block(accel, t, vInitial, p1, p2)\n            ];\n            nextSegment.entryVelocity = vFinal;\n            i += 1;\n        }\n        else if (m.vMax > vMax) {\n            // Triangle profile would exceed maximum velocity, so top out at vMax.\n            const z = computeTrapezoid(distance, vInitial, vMax, vExit, accel, p1, p2);\n            segment.blocks = [\n                new Block(accel, z.t1, vInitial, z.p1, z.p2),\n                new Block(0, z.t2, vMax, z.p2, z.p3),\n                new Block(-accel, z.t3, vMax, z.p3, z.p4)\n            ];\n            nextSegment.entryVelocity = vExit;\n            i += 1;\n        }\n        else {\n            // Accelerate, then decelerate.\n            segment.blocks = [\n                new Block(accel, m.t1, vInitial, m.p1, m.p2),\n                new Block(-accel, m.t2, m.vMax, m.p2, m.p3)\n            ];\n            nextSegment.entryVelocity = vExit;\n            i += 1;\n        }\n    }\n    const blocks = [];\n    segments.forEach((s) => {\n        s.blocks.forEach((b) => {\n            if (b.duration > epsilon) {\n                blocks.push(b);\n            }\n        });\n    });\n    return new XYMotion(blocks);\n}\nexport function plan(paths, profile) {\n    const motions = [];\n    let curPos = { x: 0, y: 0 };\n    const penMaxUpPos = profile.penUpPos < profile.penDownPos ? 100 : 0;\n    // for each path: move to the initial point, put the pen down, draw the path,\n    // then pick the pen up.\n    paths.forEach((p, i) => {\n        const m = constantAccelerationPlan(p, profile.penDownProfile);\n        const penUpPos = i === paths.length - 1 ? Device.Axidraw.penPctToPos(penMaxUpPos) : profile.penUpPos;\n        motions.push(constantAccelerationPlan([curPos, m.p1], profile.penUpProfile), new PenMotion(profile.penUpPos, profile.penDownPos, profile.penDropDuration), m, new PenMotion(profile.penDownPos, penUpPos, profile.penLiftDuration));\n        curPos = m.p2;\n    });\n    // finally, move back to (0, 0).\n    motions.push(constantAccelerationPlan([curPos, { x: 0, y: 0 }], profile.penUpProfile));\n    motions.push(new PenMotion(Device.Axidraw.penPctToPos(penMaxUpPos), profile.penUpPos, profile.penDropDuration));\n    return new Plan(motions);\n}\n","import { vadd, vlen2, vmul, vsub } from \"./vec\";\n/** Format a smallish duration in 2h30m15s form */\nexport function formatDuration(seconds) {\n    const hours = Math.floor(seconds / 60 / 60);\n    const mins = Math.floor((seconds - hours * 60 * 60) / 60);\n    const secs = Math.floor(seconds - hours * 60 * 60 - mins * 60);\n    const parts = [\n        [hours, \"h\"],\n        [mins, \"m\"],\n        [secs, \"s\"]\n    ];\n    return parts.slice(parts.findIndex((x) => x[0] !== 0)).map(([v, u]) => `${v}${u}`).join(\"\");\n}\n/** Return the top-left and bottom-right corners of the bounding box containing all points in pointLists */\nfunction extent(pointLists) {\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    let minX = Infinity;\n    let minY = Infinity;\n    for (const pl of pointLists) {\n        for (const p of pl) {\n            if (p.x > maxX) {\n                maxX = p.x;\n            }\n            if (p.y > maxY) {\n                maxY = p.y;\n            }\n            if (p.x < minX) {\n                minX = p.x;\n            }\n            if (p.y < minY) {\n                minY = p.y;\n            }\n        }\n    }\n    return [{ x: minX, y: minY }, { x: maxX, y: maxY }];\n}\n/**\n * Scale pointLists to fit within the bounding box specified by (targetMin, targetMax).\n *\n * Preserves aspect ratio, scaling as little as possible to completely fit within the box.\n *\n * Also centers the paths within the box.\n */\nfunction scaleToFit(pointLists, targetMin, targetMax) {\n    const [min, max] = extent(pointLists);\n    const availWidthMm = targetMax.x - targetMin.x;\n    const availHeightMm = targetMax.y - targetMin.y;\n    const scaleFitX = availWidthMm / (max.x - min.x);\n    const scaleFitY = availHeightMm / (max.y - min.y);\n    const scale = Math.min(scaleFitX, scaleFitY);\n    const targetCenter = vadd(targetMin, vmul(vsub(targetMax, targetMin), 0.5));\n    const offset = vsub(targetCenter, vmul(vsub(max, min), scale * 0.5));\n    return pointLists.map((pl) => pl.map((p) => vadd(vmul(vsub(p, min), scale), offset)));\n}\n/** Scale a drawing to fill a piece of paper, with the given size and margins. */\nexport function scaleToPaper(pointLists, paperSize, marginMm) {\n    return scaleToFit(pointLists, { x: marginMm, y: marginMm }, vsub(paperSize.size, { x: marginMm, y: marginMm }));\n}\n/**\n * Liang-Barsky algorithm for computing segment-AABB intersection.\n * https://gist.github.com/ChickenProp/3194723\n */\nfunction liangBarsky(aabb, seg) {\n    const [lower, upper] = aabb;\n    const [a, b] = seg;\n    const delta = vsub(b, a);\n    const p = [-delta.x, delta.x, -delta.y, delta.y];\n    const q = [a.x - lower.x, upper.x - a.x, a.y - lower.y, upper.y - a.y];\n    var u1 = -Infinity;\n    var u2 = Infinity;\n    for (let i = 0; i < 4; i++) {\n        if (p[i] == 0) {\n            if (q[i] < 0)\n                return null;\n        }\n        else {\n            const t = q[i] / p[i];\n            if (p[i] < 0 && u1 < t)\n                u1 = t;\n            else if (p[i] > 0 && u2 > t)\n                u2 = t;\n        }\n    }\n    if (u1 > u2 || u1 > 1 || u1 < 0)\n        return null;\n    return vadd(a, vmul(delta, u1));\n}\n/**\n * Returns true if aabb contains point (edge-inclusive).\n */\nfunction contains(aabb, point) {\n    const [lower, upper] = aabb;\n    return point.x >= lower.x && point.x <= upper.x && point.y >= lower.y && point.y <= upper.y;\n}\n/**\n * Returns a segment that is the subset of seg which is completely contained\n * within aabb, or null if seg is outside aabb.\n */\nfunction truncate(aabb, seg) {\n    const [a, b] = seg;\n    const containsA = contains(aabb, a);\n    const containsB = contains(aabb, b);\n    if (containsA && containsB)\n        return seg;\n    if (containsA && !containsB)\n        return [seg[0], liangBarsky(aabb, [seg[1], seg[0]])];\n    if (!containsA && containsB)\n        return [liangBarsky(aabb, seg), seg[1]];\n    const forwards = liangBarsky(aabb, seg);\n    const backwards = liangBarsky(aabb, [seg[1], seg[0]]);\n    return forwards && backwards ? [forwards, backwards] : null;\n}\n/**\n * Given a polyline, returns a list of polylines that form a subset of the\n * input polyline that is completely within aabb.\n */\nfunction cropLineToAabb(pointList, aabb) {\n    const truncatedPointLists = [];\n    let currentPointList = null;\n    for (let i = 1; i < pointList.length; i++) {\n        const [a, b] = [pointList[i - 1], pointList[i]];\n        const truncated = truncate(aabb, [a, b]);\n        if (truncated) {\n            if (!currentPointList) {\n                currentPointList = [truncated[0]];\n                truncatedPointLists.push(currentPointList);\n            }\n            currentPointList.push(truncated[1]);\n            if (truncated[1] !== b) {\n                // the end was truncated, record the end point and end the line\n                currentPointList = null;\n            }\n        }\n        else {\n            // the segment was entirely outside the aabb, end the line if there was one.\n            currentPointList = null;\n        }\n    }\n    return truncatedPointLists;\n}\n/**\n * Crops a drawing so it is kept entirely within the given margin.\n */\nexport function cropToMargins(pointLists, paperSize, marginMm) {\n    const pageAabb = [{ x: 0, y: 0 }, paperSize.size];\n    const margin = { x: marginMm, y: marginMm };\n    const insetAabb = [vadd(pageAabb[0], margin), vsub(pageAabb[1], margin)];\n    const truncatedPointLists = [];\n    for (const pointList of pointLists) {\n        for (const croppedLine of cropLineToAabb(pointList, insetAabb)) {\n            truncatedPointLists.push(croppedLine);\n        }\n    }\n    return truncatedPointLists;\n}\nexport function dedupPoints(points, epsilon) {\n    if (epsilon === 0) {\n        return points;\n    }\n    const dedupedPoints = [points[0]];\n    const epsilon2 = epsilon * epsilon;\n    for (const p of points.slice(1)) {\n        if (vlen2(vsub(p, dedupedPoints[dedupedPoints.length - 1])) > epsilon2) {\n            dedupedPoints.push(p);\n        }\n    }\n    return dedupedPoints;\n}\n","import * as Optimization from \"optimize-paths\";\nimport * as Planning from \"./planning\";\nimport { Device } from \"./planning\";\nimport { dedupPoints, scaleToPaper, cropToMargins } from \"./util\";\nimport { vmul, vrot } from \"./vec\";\n// CSS, and thus SVG, defines 1px = 1/96th of 1in\n// https://www.w3.org/TR/css-values-4/#absolute-lengths\nconst svgUnitsPerInch = 96;\nconst mmPerInch = 25.4;\nconst mmPerSvgUnit = mmPerInch / svgUnitsPerInch;\nexport function replan(inPaths, planOptions) {\n    let paths = inPaths;\n    // Rotate drawing around center of paper to handle plotting portrait drawings\n    // along y-axis of plotter\n    // Rotate around the center of the page, but in SvgUnits (not mm)\n    if (planOptions.rotateDrawing !== 0) {\n        console.time(\"rotating paths\");\n        paths = paths.map((pl) => pl.map((p) => vrot(p, vmul({ x: planOptions.paperSize.size.x / 2, y: planOptions.paperSize.size.y / 2 }, 1 / mmPerSvgUnit), planOptions.rotateDrawing)));\n        console.timeEnd(\"rotating paths\");\n    }\n    // Compute scaling using _all_ the paths, so it's the same no matter what\n    // layers are selected.\n    if (planOptions.fitPage) {\n        paths = scaleToPaper(paths, planOptions.paperSize, planOptions.marginMm);\n    }\n    else {\n        paths = paths.map(ps => ps.map(p => vmul(p, mmPerSvgUnit)));\n        if (planOptions.cropToMargins) {\n            paths = cropToMargins(paths, planOptions.paperSize, planOptions.marginMm);\n        }\n    }\n    // Rescaling loses the stroke info, so refer back to the original paths to\n    // filter based on the stroke. Rescaling doesn't change the number or order\n    // of the paths.\n    if (planOptions.layerMode === 'group') {\n        paths = paths.filter((path, i) => planOptions.selectedGroupLayers.has(inPaths[i].groupId));\n    }\n    else if (planOptions.layerMode === 'stroke') {\n        paths = paths.filter((path, i) => planOptions.selectedStrokeLayers.has(inPaths[i].stroke));\n    }\n    if (planOptions.pointJoinRadius > 0) {\n        paths = paths.map((p) => dedupPoints(p, planOptions.pointJoinRadius));\n    }\n    if (planOptions.sortPaths) {\n        console.time(\"sorting paths\");\n        paths = Optimization.reorder(paths);\n        console.timeEnd(\"sorting paths\");\n    }\n    if (planOptions.minimumPathLength > 0) {\n        console.time(\"eliding short paths\");\n        paths = Optimization.elideShorterThan(paths, planOptions.minimumPathLength);\n        console.timeEnd(\"eliding short paths\");\n    }\n    if (planOptions.pathJoinRadius > 0) {\n        console.time(\"joining nearby paths\");\n        paths = Optimization.merge(paths, planOptions.pathJoinRadius);\n        console.timeEnd(\"joining nearby paths\");\n    }\n    // Convert the paths to units of \"steps\".\n    paths = paths.map((ps) => ps.map((p) => vmul(p, Device.Axidraw.stepsPerMm)));\n    // And finally, motion planning.\n    console.time(\"planning pen motions\");\n    const plan = Planning.plan(paths, {\n        penUpPos: Device.Axidraw.penPctToPos(planOptions.penUpHeight),\n        penDownPos: Device.Axidraw.penPctToPos(planOptions.penDownHeight),\n        penDownProfile: {\n            acceleration: planOptions.penDownAcceleration * Device.Axidraw.stepsPerMm,\n            maximumVelocity: planOptions.penDownMaxVelocity * Device.Axidraw.stepsPerMm,\n            corneringFactor: planOptions.penDownCorneringFactor * Device.Axidraw.stepsPerMm,\n        },\n        penUpProfile: {\n            acceleration: planOptions.penUpAcceleration * Device.Axidraw.stepsPerMm,\n            maximumVelocity: planOptions.penUpMaxVelocity * Device.Axidraw.stepsPerMm,\n            corneringFactor: 0,\n        },\n        penDropDuration: planOptions.penDropDuration,\n        penLiftDuration: planOptions.penLiftDuration,\n    });\n    console.timeEnd(\"planning pen motions\");\n    return plan;\n}\n","import { replan } from './massager';\nself.addEventListener(\"message\", (m) => {\n    const { paths, planOptions } = m.data;\n    const plan = replan(paths, planOptions);\n    console.time(\"serializing\");\n    const serialized = plan.serialize();\n    console.timeEnd(\"serializing\");\n    self.postMessage(serialized);\n});\n// eslint-disable-next-line @typescript-eslint/no-object-literal-type-assertion\nexport default {};\n"],"sourceRoot":""}